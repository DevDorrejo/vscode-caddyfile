{
	"$schema": "https://raw.githubusercontent.com/martinring/tmlanguage/master/tmlanguage.json",

	"name": "Caddyfile",
	"fileTypes": [ "Caddyfile" ],
	"scopeName": "source.Caddyfile",

	"patterns": [
		{ "include": "#comments" },
		{ "include": "#strings" },
		{ "include": "#domains" },
		{ "include": "#status_codes" },
		{ "include": "#path" },
		{ "include": "#global_options" },
		{ "include": "#matchers" },
		{ "include": "#directive" },
		{ "include": "#site_block_common" }
	],

	"repository": {
		"comments": {
			"patterns": [
				{
					"name": "comment.line.Caddyfile",
					"match": "#.*"
				}
			]
		},

		"strings": {
			"patterns": [
				{
					"comment": "Double Quoted Strings",
					"begin": "\"",
					"end": "\"",
					"name": "string.quoted.double.Caddyfile"
				},
				{
					"comment": "Backtick Strings",
					"begin": "`",
					"end": "`",
					"name": "string.quoted.single.Caddyfile"
				}
			]
		},

		"status_codes": {
			"patterns": [
				{
					"name": "constant.numeric.decimal",
					"match": "\\s[0-9]{3}(?!\\.)"
				}
			]
		},

		"path": {
			"patterns": [
				{
					"name": "variable.other.property.caddyfile",
					"match": "(unix\/)*\/[a-zA-Z0-9_\\-./*]+"
				},
				{
					"name": "variable.other.property.caddyfile",
					"match": "\\*.[a-z]{1,5}"
				},
				{
					"name": "variable.other.property.caddyfile",
					"match": "\\*\/?"
				},
				{
					"name": "variable.other.property.caddyfile",
					"match": "\\?\/"
				}
			]
		},

		"domains": {
			"patterns": [
				{
					"comment": "Domains",
					"name": "keyword.control.caddyfile",
					"match": "(https?:\/\/)*[a-zA-Z0-9][a-zA-Z0-9-]{1,61}[a-zA-Z0-9](?:\\.[a-zA-Z]{2,})+(:[0-9]+)*"
				},
				{
					"comment": "localhost",
					"name": "keyword.control.caddyfile",
					"match": "localhost(:[0-9]+)*"
				},
				{
					"comment": "IPv4",
					"name": "keyword.control.caddyfile",
					"match": "((25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)\\.){3}(25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)"
				},
				{
					"comment": "IPv6",
					"name": "keyword.control.caddyfile",
					"match": "(([0-9a-fA-F]{1,4}:){7,7}[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,7}:|([0-9a-fA-F]{1,4}:){1,6}:[0-9a-fA-F]{1,4}|([0-9a-fA-F]{1,4}:){1,5}(:[0-9a-fA-F]{1,4}){1,2}|([0-9a-fA-F]{1,4}:){1,4}(:[0-9a-fA-F]{1,4}){1,3}|([0-9a-fA-F]{1,4}:){1,3}(:[0-9a-fA-F]{1,4}){1,4}|([0-9a-fA-F]{1,4}:){1,2}(:[0-9a-fA-F]{1,4}){1,5}|[0-9a-fA-F]{1,4}:((:[0-9a-fA-F]{1,4}){1,6})|:((:[0-9a-fA-F]{1,4}){1,7}|:)|fe80:(:[0-9a-fA-F]{0,4}){0,4}%[0-9a-zA-Z]{1,}|::(ffff(:0{1,4}){0,1}:){0,1}((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])|([0-9a-fA-F]{1,4}:){1,4}:((25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9])\\.){3,3}(25[0-5]|(2[0-4]|1{0,1}[0-9]){0,1}[0-9]))"
				},
				{
					"comment": "Ports",
					"name": "keyword.control.caddyfile",
					"match": ":[0-9]+"
				}
			]
		},

		"global_options": {
			"patterns": [
				{
					"begin": "^(\\{)$",
					"end": "^(\\})$",

					"beginCaptures": {
						"0": { "name": "punctuation.definition.dictionary.begin" }
					},

					"endCaptures": {
						"0": { "name": "punctuation.definition.dictionary.end" }
					},

					"patterns": [
						{
							"name": "support.constant.Caddyfile",
							"match": "^\\s*(debug|https?_port|default_sni|order|experimental_http3|storage|acme_ca|acme_ca_root|email|admin|on_demand_tls|local_certs|key_type|auto_https)"
						}
					]
				}
			]
		},

		"site_block_common": {
			"patterns": [
				{ "include": "#placeholders" },
				{ "include": "#block" }
			]
		},

		"matchers": {
			"patterns": [
				{
					"comment": "Matchers",
					"name": "support.function.Caddyfile",
					"match": "@[^\\s]+(?=\\s)"
				}
			]
		},

		"placeholders": {
			"patterns": [
				{
					"name": "keyword.control.Caddyfile",
					"match": "\\{[\\w+.\\$-]+\\}"
				}
			]
		},

		"directive": {
			"patterns": [
				{
					"name": "entity.name.function.Caddyfile",
					"match": "^\\s*[a-zA-Z_\\-+]+"
				}
			]
		},

		"block": {
			"patterns": [
				{
					"begin": "\\{",
					"end": "\\}",

					"patterns": [
						{ "include": "#comments" },
						{ "include": "#strings" },
						{ "include": "#domains" },
						{ "include": "#status_codes" },
						{ "include": "#path" },
						{ "include": "#matchers" },
						{ "include": "#placeholders" },
						{ "include": "#directive" },
						{ "include": "#block" }
					]
				}
			]
		}
	}
}
