{
    auto_https disable_redirects
}

cp.dnf.wtf:7135 {
    # Application Root
    root * /var/www/dnf.wtf/cp/public/

    # Enable the file server (required for assets to be served)
    file_server

    # TLS
    tls "/root/.acme.sh/*.dnf.wtf/fullchain.cer" "/root/.acme.sh/*.dnf.wtf/*.dnf.wtf.key" {
        protocols tls1.2 tls1.3
    }

    # Headers
    header {
        -Server
        Referrer-Policy        "same-origin"
        +X-Frame-Options       "deny"
        X-XSS-Protection       "1; mode=block"
        X-Content-Type-Options "nosniff"
    }

    # Enable compression
    encode gzip zstd

    # PHP-FPM
    php_fastcgi unix//var/run/php-fpm/www.sock

    # Match dotfiles
    @startsWithDot {
        path \/\.
        not path .well-known
    }

    # ?
    rewrite @startsWithDot /index.php{uri}

    # ?
    @phpRewrite {
        not file favicon.ico
    }

    # ?
    try_files @phpRewrite {path} {path}/ /index.php?{query}
}
